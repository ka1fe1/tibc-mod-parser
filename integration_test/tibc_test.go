package integration

import (
	"encoding/hex"
	"fmt"
	. "github.com/kaifei-bianjie/common-parser/codec"
	"github.com/kaifei-bianjie/common-parser/utils"
)

func (s IntegrationTestSuite) TestTIBC() {
	cases := []SubTest{
		{
			"TIBCNftTransfer",
			TIBCNftTransfer,
		},
		{
			"TIBCRecvPacket",
			TIBCRecvPacket,
		},
		{
			"TIBCUpdateClient",
			TIBCUpdateClient,
		},
		{
			"TIBCAcknowledgement",
			TIBCAcknowledgement,
		},
		{
			"TIBCCleanPacket",
			TIBCCleanPacket,
		},
		{
			"TIBCRecvCleanPacket",
			TIBCRecvCleanPacket,
		},
	}

	for _, t := range cases {
		s.Run(t.testName, func() {
			t.testCase(s)
		})
	}
}

func TIBCNftTransfer(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)

	txBytes, err := hex.DecodeString("0AA8010AA5010A292F746962632E617070732E6E66745F7472616E736665722E76312E4D73674E66745472616E7366657212780A0A746573746E6674383138120568686877621A2A6961613134636C706E377A32397067397538347136363261383636323365633675326B63706866636464222A6961613134636C706E377A32397067397538347136363261383636323365633675326B637068666364642A0B6D74746962632D7465737412660A500A460A1F2F636F736D6F732E63727970746F2E736563703235366B312E5075624B657912230A2103E1331261D08B397389A0EFF4DFF773C12E4433DAD6272C915E754C4DCA47A5A912040A020801182712120A0C0A05756E79616E120334303010C09A0C1A4016746BCED8E685130094079096737923FDB5468DD15D6D5D2613CFF277AFF27A46B5D38E22FE8DB22C86170C55C73E440FA19119E8653B2ACD4975CD890DE98E")
	if err != nil {
		s.T().Log(err.Error())
		panic(err)
	}

	authTx, err := GetSigningTx(txBytes)
	if err != nil {
		s.T().Log(err.Error())
		panic(err)
	}

	for _, msg := range authTx.GetMsgs() {
		if mtDoc, ok := s.Tibc.HandleTxMsg(msg); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(mtDoc))
		}
	}
}

func TIBCRecvPacket(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)

	txBytes, err := hex.DecodeString("")
	if err != nil {
		s.T().Log(err.Error())
		panic(err)
	}

	authTx, err := GetSigningTx(txBytes)
	if err != nil {
		s.T().Log(err.Error())
		panic(err)
	}

	for _, msg := range authTx.GetMsgs() {
		if mtDoc, ok := s.Tibc.HandleTxMsg(msg); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(mtDoc))
		}
	}
}

func TIBCUpdateClient(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)

	txBytes, err := hex.DecodeString("0AEC070AE9070A242F746962632E636F72652E636C69656E742E76312E4D7367557064617465436C69656E7412C0070A0B6D74746962632D746573741284070A272F746962632E6C69676874636C69656E74732E74656E6465726D696E742E76312E48656164657212D8060AD0040A93030A02080B120C636861696E2D716D4D5A316A18AF3D220C08B198CC910610B78EC0C5022A480A208F9AE796B3439C93F5552A1BE0028CE384AA7F3C298C408504245790620F9D761224080112203209661F0917854E4800B07DBFB726E735B8C6B05E803E2E5ABDB75079090D84322025C5143FF3CF7F78BE865DA67EE6D2CA917BC4B13A27ED51D3E0CA191DAE78043A20E3B0C44298FC1C149AFBF4C8996FB92427AE41E4649B934CA495991B7852B85542209532943B43D88B07F22C35B1642C34AE6A9E2F8B7E00CA931E4A4EDCFCFD469E4A209532943B43D88B07F22C35B1642C34AE6A9E2F8B7E00CA931E4A4EDCFCFD469E5220048091BC7DDC283F77BFBF91D73C44DA58C3DF8A9CBC867405D8B7F3DAADA22F5A20539CA8533B432095A061F3AABEFA59E1C1CE7EBADB925C9C39E149FFB3814EFC6220F4D9F99915AFFA9FEA90F72F20AA99C6EA5D1581953BF7C546EEE58A50957A0B6A20E3B0C44298FC1C149AFBF4C8996FB92427AE41E4649B934CA495991B7852B8557214883EE6FEB697706054C97C43C5F5198E1D70E2EC12B70108AF3D1A480A208BCAE5B77845D5A8B572461BA4A7F25BC798FF032769248D231DDA1B7E5C308C122408011220499B441FD0BB88BCA22DDF667127115D5A9FD3500977362F042EB657E4269085226808021214883EE6FEB697706054C97C43C5F5198E1D70E2EC1A0C08B698CC910610A4A885D0022240F587B4E458CE4C898D94DDF0662DDA3D108158C2BEF3974C3933CA435B3F21714234EE6AD02BE4BD4F83188FC1022E585CE41F8A627BA4CF32EE3C98F391C30C127E0A3C0A14883EE6FEB697706054C97C43C5F5198E1D70E2EC12220A2019018E53BC63E495B51802637616CD7CE38A1809FF01A9EEFBCE039CFFB72CDD1864123C0A14883EE6FEB697706054C97C43C5F5198E1D70E2EC12220A2019018E53BC63E495B51802637616CD7CE38A1809FF01A9EEFBCE039CFFB72CDD186418641A0310873D227E0A3C0A14883EE6FEB697706054C97C43C5F5198E1D70E2EC12220A2019018E53BC63E495B51802637616CD7CE38A1809FF01A9EEFBCE039CFFB72CDD1864123C0A14883EE6FEB697706054C97C43C5F5198E1D70E2EC12220A2019018E53BC63E495B51802637616CD7CE38A1809FF01A9EEFBCE039CFFB72CDD186418641A2A69616131726C77736C3564353735366673346B35653268677A647671346470683468353672783667777712670A510A460A1F2F636F736D6F732E63727970746F2E736563703235366B312E5075624B657912230A21021EF0B028BFAF41484A0501D127284A95FF7590E159B91B91F5295C8741A009FC12040A02080118CE0112120A0C0A05756E79616E120335303010C09A0C1A403335C87864A577719CC491ED293A3DD346C58A58CFBD5B782143F2E5C18F39BE05E326256D60B9C6962D8656225308E51544E1D2CEBFD4814823D6ABE1606FEF")
	if err != nil {
		s.T().Log(err.Error())
		panic(err)
	}

	authTx, err := GetSigningTx(txBytes)
	if err != nil {
		s.T().Log(err.Error())
		panic(err)
	}

	for _, msg := range authTx.GetMsgs() {
		if mtDoc, ok := s.Tibc.HandleTxMsg(msg); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(mtDoc))
		}
	}
}

func TIBCAcknowledgement(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)

	txBytes, err := hex.DecodeString("0AB7070AB4070A272F746962632E636F72652E7061636B65742E76312E4D736741636B6E6F776C656467656D656E741288070A9E01080212034E46541A0A697269736875622D7161220E62736E6875622D6D61696E6E657432790A04706E7A6E120777687A657A6D661A0E687474703A2F2F6269656A767961222A696161316571766B667468747272393367347039717370703534773664746A74726E32376172377270772A2A69616131343863613266766C7574397A303663397967787739706772716E32717063717532383732396A30011204AA0101011AAC050AA9030AA6030A2A61636B732F697269736875622D71612F62736E6875622D6D61696E6E65742F73657175656E6365732F321220E2E240ED1D7B1EE6BE77E9101B573C90800CF8D61D6EFF892F9D7D987CCC33831A0D0801180120012A050002B28802222B080112270204B288022093C74F7E9F58D47CB7B3B45C5F4AB7C4644892DDC60D042DED5AEE75B781215220222D080112060408B28802201A2120A13C19BBA8E3FA0EE0940EEA516DA399A4CFAF52982B0CDEA774D7AA670F5B43222D080112060812B28802201A2120A6D68E2A7047D6AE507F33E12D85E18F12F09CE4445D2FB7F5C54F7A1C766AB1222D080112060A2CB28802201A2120CC18F02B5648C12A3896F5D8A288643FC36C5BA35EEC7FD5797A1DAC929CE2C4222D080112060C60B28802201A21206C8A8CCBC8C0C1D5E178841B42910C55B5AD399A98D3D9DBAC51A811CE6F58AF222E080112070EAE01B28802201A2120CA35F92F69A3D1E12DE163932E4A69766AB97CB144C0CB920E1E57ED1F221028222E0801120710A002B28802201A21207719749C7C75E976A59942248052F9D36CC1D17F850E7306DD261122742006250AFD010AFA010A04746962631220FCECB3B20FD69E8F4995A18E77777E3CBD6C805D19FE2299CE88AA0264C244271A090801180120012A0100222508011221016B2DB9110F4DBA1EC725BF8F700C0DC5103B512A22BCEEB261ECFAE4E5B7350C222708011201011A2047C03F1071EBDC9BF307A17367E08070EF34E210561B3C4A8116109337EFFDC722250801122101751C89592E55B6C81747F54BBD3494ABEE8941AE5705259FBC1D55F28A150245222708011201011A20F807BDF7CA6BC5E8B99ECF2C0946589596BCDD12EB15910A117D56BC1812635B2225080112210134B2708A3E2AB51F8612C625B33663BAC12CEF3FAE076159257DF128A55B83982204109A84012A2A6961613137636A64673633746879327666717676676A356C667635647033333974306C7261326771387512680A510A460A1F2F636F736D6F732E63727970746F2E736563703235366B312E5075624B657912230A2102A53EA4DC106AE521C8354FD35F57149A9EEC9530332D2D6C53C80BB3F323A7D412040A02080118D12212130A0C0A05756972697312033130301080C2D72F1A40287147DE3996800A7D37245F223062320DB9F4E37DB5E270292FB8F599A13E802AC54AE8C4DD76321501F9D508A361B66E28333426A899BF49A5DB705C503869")
	if err != nil {
		s.T().Log(err.Error())
		panic(err)
	}

	authTx, err := GetSigningTx(txBytes)
	if err != nil {
		s.T().Log(err.Error())
		panic(err)
	}

	for _, msg := range authTx.GetMsgs() {
		if mtDoc, ok := s.Tibc.HandleTxMsg(msg); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(mtDoc))
		}
	}
}

func TIBCCleanPacket(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)

	txBytes, err := hex.DecodeString("0A670A650A232F746962632E636F72652E7061636B65742E76312E4D7367436C65616E5061636B6574123E0A1008BB03220B697269736875622D716162122A696161316571766B667468747272393367347039717370703534773664746A74726E323761723772707712650A510A460A1F2F636F736D6F732E63727970746F2E736563703235366B312E5075624B657912230A21038BE4539785F0621A19066EB2DA45C11DCC5FCCFF5D58E89C670BB80D251CC1B712040A02080118BE0312100A0A0A05756972697312013210C09A0C1A40771C4E797C8B9B85320B20BE93FF885FEB9F85DE49FC26277D6C08A53F860FE074D48A64273DE5B99FA7C3FD47D7024A1A29FAD5808EAA4B9D9984DC282AF02C")
	if err != nil {
		s.T().Log(err.Error())
		panic(err)
	}

	authTx, err := GetSigningTx(txBytes)
	if err != nil {
		s.T().Log(err.Error())
		panic(err)
	}

	for _, msg := range authTx.GetMsgs() {
		if mtDoc, ok := s.Tibc.HandleTxMsg(msg); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(mtDoc))
		}
	}
}

func TIBCRecvCleanPacket(s IntegrationTestSuite) {
	SetBech32Prefix(Bech32PrefixAccAddr, Bech32PrefixAccPub, Bech32PrefixValAddr,
		Bech32PrefixValPub, Bech32PrefixConsAddr, Bech32PrefixConsPub)

	txBytes, err := hex.DecodeString("0A660A640A232F746962632E636F72652E7061636B65742E76312E4D7367436C65616E5061636B6574123D0A0F08BB03220A697269736875622D7161122A696161316571766B667468747272393367347039717370703534773664746A74726E323761723772707712650A510A460A1F2F636F736D6F732E63727970746F2E736563703235366B312E5075624B657912230A21038BE4539785F0621A19066EB2DA45C11DCC5FCCFF5D58E89C670BB80D251CC1B712040A02080118BD0312100A0A0A05756972697312013210C09A0C1A40BF219D914A71CA44319952DB7C1E80129F936D045271D427D93BF1A1ED9839E54E207C5BD45306FC4833A9EDB8FDE15A7D63F9290197FB877CD0E5E2EB640476")
	if err != nil {
		s.T().Log(err.Error())
		panic(err)
	}

	authTx, err := GetSigningTx(txBytes)
	if err != nil {
		s.T().Log(err.Error())
		panic(err)
	}

	for _, msg := range authTx.GetMsgs() {
		if mtDoc, ok := s.Tibc.HandleTxMsg(msg); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(mtDoc))
		}
	}
}
